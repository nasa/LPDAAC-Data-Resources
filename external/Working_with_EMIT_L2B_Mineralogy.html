<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>working_with_emit_l2b_mineralogy â€“ LP DAAC Data Resources</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../CONTRIBUTING.html" rel="next">
<link href="../external/Finding_EMIT_L2B_Data.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-fdfdc58ad6c2f6f036eeed4db0fdae11.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../web_book/python_resources.html">Python Resources</a></li><li class="breadcrumb-item"><a href="../external/How_to_find_and_access_EMIT_data.html">EMIT</a></li><li class="breadcrumb-item"><a href="../external/Working_with_EMIT_L2B_Mineralogy.html">10. Working with EMIT L2B Mineralogy</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/lpdaac-logo-black.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Data Resources</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://nasa.github.io/LPDAAC-Data-Resources/" title="LP DAAC Data Resources Website" class="quarto-navigation-tool px-1" aria-label="LP DAAC Data Resources Website"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/nasa/LPDAAC-Data-Resources" title="LP DAAC Data Resources Repository" class="quarto-navigation-tool px-1" aria-label="LP DAAC Data Resources Repository"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">WICSIS 2024 EMIT Access Workshop</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../web_book/wicsis_2024.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Setup Instructions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/prerequisites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prerequisites</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/workshop_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cloud Workspace Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/setup_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Local Python Environment Setup</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/How_to_find_and_access_EMIT_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Finding and Accessing EMIT Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/Exploring_EMIT_L2A_Reflectance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Exploring EMIT L2A Reflectance</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Past Workshops</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../web_book/igarss_2024.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2024 IGARSS Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../web_book/vitals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2023/2024 VITALS Workshop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../web_book/emit_tutorial_series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LP/JPL EMIT Tutorial Series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Python Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../web_book/python_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/workshop_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cloud Workspace Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/setup_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Local Python Setup</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">EMIT</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/How_to_find_and_access_EMIT_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Finding and Accessing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/Exploring_EMIT_L2A_Reflectance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Exploring EMIT L2A Reflectance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/How_to_Convert_to_ENVI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Converting to ENVI format</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/How_to_Extract_Points.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Extracting Points</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/How_to_Extract_Area.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Extracting Area</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/How_to_use_EMIT_Quality_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Using Quality Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/Generating_Methane_Spectral_Fingerprint.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Generating Methane Spectral Fingerprint</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/Visualizing_Methane_Plume_Timeseries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Visualizing Methane Plume Timeseries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/Finding_EMIT_L2B_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Finding EMIT L2B Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../external/Working_with_EMIT_L2B_Mineralogy.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">10. Working with EMIT L2B Mineralogy</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CONTRIBUTING.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing to this Repository</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CODE_OF_CONDUCT.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code of Conduct</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#working-with-emit-l2b-mineralogy-data" id="toc-working-with-emit-l2b-mineralogy-data" class="nav-link active" data-scroll-target="#working-with-emit-l2b-mineralogy-data">Working with EMIT L2B Mineralogy Data</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">1. Setup</a></li>
  <li><a href="#downloaded-data" id="toc-downloaded-data" class="nav-link" data-scroll-target="#downloaded-data">1.2 Downloaded Data</a></li>
  <li><a href="#working-with-the-l2b-mineral-identification-and-band-depth" id="toc-working-with-the-l2b-mineral-identification-and-band-depth" class="nav-link" data-scroll-target="#working-with-the-l2b-mineral-identification-and-band-depth">2. Working with the L2B Mineral Identification and Band Depth</a>
  <ul class="collapse">
  <li><a href="#orthorectification" id="toc-orthorectification" class="nav-link" data-scroll-target="#orthorectification">2.1 Orthorectification</a></li>
  </ul></li>
  <li><a href="#visualize-group-1-minerals" id="toc-visualize-group-1-minerals" class="nav-link" data-scroll-target="#visualize-group-1-minerals">2.2 Visualize Group 1 Minerals</a></li>
  <li><a href="#visualize-group-2-minerals" id="toc-visualize-group-2-minerals" class="nav-link" data-scroll-target="#visualize-group-2-minerals">2.3 Visualize Group 2 Minerals</a></li>
  <li><a href="#visualizing-and-filtering-with-uncertainties" id="toc-visualizing-and-filtering-with-uncertainties" class="nav-link" data-scroll-target="#visualizing-and-filtering-with-uncertainties">2.4 Visualizing and filtering with uncertainties</a></li>
  <li><a href="#aggregating-and-mineral-abundance" id="toc-aggregating-and-mineral-abundance" class="nav-link" data-scroll-target="#aggregating-and-mineral-abundance">3. Aggregating and Mineral Abundance</a></li>
  </ul></li>
  <li><a href="#approximating-mineral-spectral-abundance" id="toc-approximating-mineral-spectral-abundance" class="nav-link" data-scroll-target="#approximating-mineral-spectral-abundance">3.1 Approximating Mineral Spectral Abundance</a>
  <ul class="collapse">
  <li><a href="#exporting-to-cloud-optimized-geotiffs" id="toc-exporting-to-cloud-optimized-geotiffs" class="nav-link" data-scroll-target="#exporting-to-cloud-optimized-geotiffs">4. Exporting To Cloud-Optimized Geotiffs</a>
  <ul class="collapse">
  <li><a href="#mineral-id" id="toc-mineral-id" class="nav-link" data-scroll-target="#mineral-id">4.1 Mineral ID</a></li>
  <li><a href="#band-depth" id="toc-band-depth" class="nav-link" data-scroll-target="#band-depth">4.2 Band Depth</a></li>
  <li><a href="#abundance" id="toc-abundance" class="nav-link" data-scroll-target="#abundance">4.3 Abundance</a></li>
  </ul></li>
  <li><a href="#contact-info" id="toc-contact-info" class="nav-link" data-scroll-target="#contact-info">Contact Info:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<blockquote class="blockquote">
<p>
This notebook is from <a href="https://github.com/nasa/EMIT-Data-Resources">EMIT-Data-Resources</a>
</p>
<p>
Source: <a href="https://github.com/nasa/EMIT-Data-Resources/blob/main/python/tutorials/Working_with_EMIT_L2B_Mineralogy.ipynb">Working with EMIT L2B Mineralogy Data</a>
</p>
<p>Imported on: <strong>2025-01-22</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Disclaimer:</strong> The <a href="https://doi.org/10.5067/EMIT/EMITL2BMIN.001"><strong>EMITL2BMIN</strong></a> product is generated to support the EMIT mission objectives of constraining the sign of dust related radiative forcing. Ten mineral types are the core focus of this work: Calcite, Chlorite, Dolomite, Goethite, Gypsum, Hematite, Illite+Muscovite, Kaolinite, Montmorillonite, and Vermiculite. The <a href=""><strong>EMIT_L3_ASA</strong></a> product contain the aggregate abundance of these minerals at a coarser resolution for use in Earth System Models. Additional minerals are included in the <strong>EMITL2BMIN</strong> product for transparency but were not the focus of this product. Further validation is required to use these additional mineral maps, particularly in the case of resource exploration. Similarly, the separation of minerals with similar spectral features, such as a fine-grained goethite and hematite, is an area of active research. The results presented here are an initial offering, but the precise categorization is likely to evolve over time, and the limits of what can and cannot be separated on the global scale is still being explored. The user is encouraged to read the <a href="https://lpdaac.usgs.gov/documents/1659/EMITL2B_ATBD_v1.pdf">Algorithm Theoretical Basis Document (ATBD)</a> for more details.</p>
</blockquote>
<section id="working-with-emit-l2b-mineralogy-data" class="level1">
<h1>Working with EMIT L2B Mineralogy Data</h1>
<p><strong>Summary</strong></p>
<p>In this notebook we will open the <a href="https://doi.org/10.5067/EMIT/EMITL2BMIN.001">EMIT L2B Estimated Mineral Identification and Band Depth and Uncertainty (EMITL2BMIN)</a> products, find a mineral of interest from the ten mineral types focused on by the EMIT mission, evaluate uncertainty, orthorectify the data, then create an output mask or vector file for the granule.</p>
<p><strong>Background</strong></p>
<p>The EMIT instrument is an imaging spectrometer that measures light in visible and infrared wavelengths. These measurements display unique spectral signatures that correspond to the composition on the Earthâ€™s surface. The EMIT mission focuses specifically on mapping the composition of minerals to better understand the effects of mineral dust throughout the Earth system and human populations now and in the future. More details about EMIT and its associated products can be found in the <strong>README.md</strong> and on the <a href="https://earth.jpl.nasa.gov/emit/">EMIT website</a>.</p>
<p>The <a href="https://doi.org/10.5067/EMIT/EMITL2BMIN.001">EMITL2BMIN</a> data product provides estimated mineral identification, band depths and uncertainty in a spatially raw, non-orthocorrected format. Two spectral groups, which correspond to different regions of the spectra, are identified independently and often co-occur are used to identify minerals. These estimates are generated using the <a href="https://www.usgs.gov/publications/tetracorder-user-guide-version-44?_gl=1*1eoj33d*_ga*MTU3MTA3ODgxNS4xNjQ5MTg1MDgx*_ga_0YWDZEJ295*MTY4NjkyNTg0Mi40NC4xLjE2ODY5MjU4NzMuMC4wLjA.">Tetracorder system</a>(<a href="https://github.com/PSI-edu/spectroscopy-tetracorder">code</a>) and are based on <a href="https://doi.org/10.5067/EMIT/EMITL2ARFL.001">EMITL2ARFL</a> reflectance values. The product also consists of an EMIT_L2B_MINUNCERT file, which provides band depth uncertainty estimates calculated using surface Reflectance Uncertainty values from the <a href="https://doi.org/10.5067/EMIT/EMITL2ARFL.001">EMITL2ARFL</a> data product. The band depth uncertainties are presented as standard deviations, and the fit score for each mineral identification is also provided as the coefficient of determination (r<sup>2</sup>) of the match between the continuum normalized library reference and the continuum normalized observed spectrum. Associated metadata indicates the name and reference information for each identified mineral, and additional information about aggregating minerals into different categories, and the code used for product generation is available in the <a href="">emit-sds-l2b repository</a>.</p>
<p><strong>Disclaimer</strong></p>
<p>The <a href="https://doi.org/10.5067/EMIT/EMITL2BMIN.001">EMIT_L2B_MIN</a> product is generated to support the EMIT mission objectives of constraining the sign of dust related radiative forcing. Ten mineral types are the core focus of this work: Calcite, Chlorite, Dolomite, Goethite, Gypsum, Hematite, Illite+Muscovite, Kaolinite, Montmorillonite, and Vermiculite. A future product will aggregate these results for use in Earth System Models. Additional minerals are included in this product for transparency but were not the focus of this product. Further validation is required to use these additional mineral maps, particularly in the case of resource exploration. Similarly, the separation of minerals with similar spectral features, such as a fine-grained goethite and hematite, is an area of active research. The results presented here are an initial offering, but the precise categorization is likely to evolve over time, and the limits of what can and cannot be separated on the global scale is still being explored. The user is encouraged to read the <a href="https://lpdaac.usgs.gov/documents/1659/EMITL2B_ATBD_v1.pdf">Algorithm Theoretical Basis Document (ATBD)</a> for more details.</p>
<p><strong>Requirements</strong> - Set up Python Environment - See <strong>setup_instructions.md</strong> in the <code>/setup/</code> folder</p>
<p><strong>Learning Objectives</strong><br>
- How to open an EMIT L2B <code>.nc</code> file as an <code>xarray.Dataset</code> - Apply the Geometry Lookup Table (GLT) to orthorectify the image. - Find minerals of interest within a granule - Visualize Mineral Identification and Band depth - Evaluate mineral uncertainty - Calculate and Visualize mineral Abundance</p>
<p><strong>Tutorial Outline</strong></p>
<ol type="1">
<li>Setup<br>
</li>
<li>Working with Mineral Identification and Band Depth</li>
<li>Aggregating and Mineral Abundance</li>
<li>Exporting to Cloud-Optimized GeoTIFF (COG)</li>
</ol>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">1. Setup</h2>
<p>Import the required Python libraries.</p>
<div id="5370bd60-e09c-4ba2-82f7-09697360ff79" class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> earthaccess</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gp</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hvplot.xarray</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> holoviews <span class="im">as</span> hv</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> panel <span class="im">as</span> pn</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'../modules/'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> emit_tools <span class="im">as</span> et</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Login to your NASA Earthdata account and create a <code>.netrc</code> file using the <code>login</code> function from the <code>earthaccess</code> library. If you do not have an Earthdata Account, you can create one <a href="https://urs.earthdata.nasa.gov/home">here</a>.</p>
<div id="909ddf57" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>earthaccess.login(persist<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this notebook we will download the files necessary using <code>earthaccess</code>. You can also access the data in place or stream it, but this can slow due to the file sizes. Provide a URL for an EMIT L2B Mineral Identification and Band Depth granule.</p>
<div id="0b858790" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the browse images from the text file output of the previous notebook.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>min_list <span class="op">=</span> <span class="st">'../../data/results_urls.txt'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(min_list) <span class="im">as</span> f:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    min_urls <span class="op">=</span> [line.rstrip(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>) <span class="cf">for</span> line <span class="kw">in</span> f]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>min_urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="57a34e59" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the browse images from the text file output of the previous notebook.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>unc_list <span class="op">=</span> <span class="st">'../../data/min_uncert_urls.txt'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(unc_list) <span class="im">as</span> f:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    unc_urls <span class="op">=</span> [line.rstrip(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>) <span class="cf">for</span> line <span class="kw">in</span> f]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>unc_urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get an HTTPS Session using your earthdata login, set a local path to save the file, and download the granule asset, in this case we are selecting the second scene (index 1) from the list of granules for both the mineral and uncertainty files.</p>
<div id="eb62adee" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> earthaccess.get_fsspec_https_session()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fp <span class="op">=</span> fs.<span class="bu">open</span>(min_urls[<span class="dv">0</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>fp_un <span class="op">=</span> fs.<span class="bu">open</span>(unc_urls[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="downloaded-data" class="level2">
<h2 class="anchored" data-anchor-id="downloaded-data">1.2 Downloaded Data</h2>
<p>If youâ€™ve already downloaded the data using the workflow shown in Section 6 of the <a href="Finding_EMIT_L2B_Mineralogy_Data.ipynb">Finding EMIT L2B Mineralogy Data</a> , you can just set filepaths using the cell below.</p>
<div id="14114c12-c896-43d9-9424-3d015b98a0b5" class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fp = '../../data/EMIT_L2B_MIN_001_20230427T173309_2311711_010.nc' # Mineral</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#fp_rgb = '../../data/EMIT_L2A_RFL_001_20230427T173309_2311711_010.png' # RGB</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#fp_un = '../../data/EMIT_L2B_MINUNCERT_001_20230427T173309_2311711_010.nc' # Mineral Uncertainty</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="working-with-the-l2b-mineral-identification-and-band-depth" class="level2">
<h2 class="anchored" data-anchor-id="working-with-the-l2b-mineral-identification-and-band-depth">2. Working with the L2B Mineral Identification and Band Depth</h2>
<p>EMITL2BMIN data are distributed in a non-orthocorrected spatially raw NetCDF4 (.nc) format consisting of the data and its associated metadata. Inside the <code>.nc</code> file there are 3 groups. Groups can be thought of as containers to organize the data.</p>
<ol type="1">
<li>The root group that can be considered the main dataset contains 4 data variables data described by the downtrack, and crosstrack dimensions. These variables are <code>group_1_mineral_id</code>, <code>group_1_band_depth</code>, <code>group_2_mineral_id</code>, and <code>group_2_band_depth</code>. These contain the ID and a band depth for each mineral group. These groups do not correspond to the <code>.netcdf</code> file groups, but rather the spectral library groups used to identify the minerals based on which region of the spectra the mineral features correspond to.</li>
<li>The <code>mineral_metadata</code> group containing the spectral library entry name, index, record, group, and url for each entry.</li>
<li>The <code>location</code> group contains latitude and longitude values at the center of each pixel described by the crosstrack and downtrack dimensions, as well as a geometry lookup table (GLT) described by the ortho_x and ortho_y dimensions. The GLT is an orthorectified image (EPSG:4326) consisting of 2 layers containing downtrack and crosstrack indices. These index positions allow us to quickly project the raw data onto this geographic grid.</li>
</ol>
<p>To access the <code>.nc</code> file, you can use the <code>netCDF4</code>, <code>xarray</code> libraries, or fuctions from the <code>emit_tools.py</code> library. Here we will use the <code>emit_xarray</code> function from this library, which will open and organize the data into an easy to work with <code>xarray.Dataset</code> object. We can also pass the <code>ortho=True</code> argument to orthorectify the data at this stage, but we will start just examining the data to get a better understanding.</p>
<div id="1e97803b-d221-45b0-b388-a851b5fee96a" class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ds_min <span class="op">=</span> et.emit_xarray(fp)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ds_min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look at the mineral <code>index</code> by printing the first 5 values, we can see that values start with 1. If we look at the minimum values of the mineral IDs we can see these have 0 as a possible value.</p>
<div id="6bdd201e" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ds_min.index.data[:<span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="768344b0" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Group_1_minimum:</span><span class="sc">{</span>ds_min<span class="sc">.</span>group_1_mineral_id<span class="sc">.</span>data<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> Group_2_minimum: </span><span class="sc">{</span>ds_min<span class="sc">.</span>group_2_mineral_id<span class="sc">.</span>data<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The 0 here represents no match. For convenience, letâ€™s make a DataFrame that holds the mineral data, and add that â€˜No matchâ€™ reference to it:</p>
<div id="88e8e8bc-1eb6-4b8c-96ee-2c043b8ce9cc" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>min_df <span class="op">=</span> pd.DataFrame({x: ds_min[x].values <span class="cf">for</span> x <span class="kw">in</span> [var <span class="cf">for</span> var <span class="kw">in</span> ds_min.coords <span class="cf">if</span> <span class="st">'mineral_name'</span> <span class="kw">in</span> ds_min[var].dims]})</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>min_df.loc[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> {<span class="st">'index'</span>: <span class="dv">0</span>, <span class="st">'mineral_name'</span>: <span class="st">'No_Match'</span>, <span class="st">'record'</span>: <span class="op">-</span><span class="fl">1.0</span>, <span class="st">'url'</span>: <span class="st">'NA'</span>, <span class="st">'group'</span>: <span class="fl">1.0</span>, <span class="st">'library'</span>: <span class="st">'NA'</span>, <span class="st">'spatial_ref'</span>: <span class="dv">0</span>}</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>min_df <span class="op">=</span> min_df.sort_index().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>min_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="orthorectification" class="level3">
<h3 class="anchored" data-anchor-id="orthorectification">2.1 Orthorectification</h3>
<p>The orthorectifation process has already been done for EMIT data. Here we are just using the crosstrack and downtrack indices contained in the GLT to place our spatially raw mineralogy data a into geographic grid with the <code>ortho_x</code> and <code>ortho_y</code> dimensions.</p>
<div id="c444096a" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ds_min <span class="op">=</span> et.ortho_xr(ds_min)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ds_min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see from these outputs that the dimensions are now latitude and longitude.</p>
<p>In this example, weâ€™ll just work with the group_1 mineral data. We can find the minerals present in the scene by finding unique values in the <code>group_1_mineral_id</code>, but first we will replace fill-values introduced during orthorectification with <code>np.nan</code>, to omit them from our analysis and improve visualizations.</p>
<div id="2d2679d1" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign fill to np.nan</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> ds_min.data_vars:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ds_min[var].data[ds_min[var].data <span class="op">==</span> <span class="op">-</span><span class="dv">9999</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="visualize-group-1-minerals" class="level2">
<h2 class="anchored" data-anchor-id="visualize-group-1-minerals">2.2 Visualize Group 1 Minerals</h2>
<p>To visualize minerals present, plot Group 1 Minerals using a categorical color set. You can hover over a colored region to see the zero-based mineral id from the spectral library. Note that these values correspond to the 1-based index value.</p>
<div id="5debcfaf" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ds_min[<span class="st">'group_1_mineral_id'</span>].hvplot.image(cmap<span class="op">=</span><span class="st">'glasbey'</span>, geo<span class="op">=</span><span class="va">True</span>, tiles<span class="op">=</span><span class="st">'ESRI'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,frame_width<span class="op">=</span><span class="dv">750</span>).opts(title<span class="op">=</span><span class="st">'Group 1 Mineral ID'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This figure shows the minerals present in the scene, but doesnâ€™t really quantify how well they matched with the spectral library. For that we can look at the band depth for each mineral. We can build an interactive tool to do this using the <code>panel</code> and <code>hvplot</code> libraries. This will take a bit of time to load for each selection.</p>
<p>Because many minerals are scarce, weâ€™ll start by updating the names to include relative fractions</p>
<div id="e490efeb-0e98-4a95-8ed4-9167ee5029c3" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>g1_min_percent <span class="op">=</span> [np.<span class="bu">round</span>(np.<span class="bu">sum</span>(ds_min.group_1_mineral_id.data.flatten() <span class="op">==</span> g1min) <span class="op">/</span> np.<span class="bu">sum</span>(ds_min.group_1_mineral_id.data.flatten() <span class="op">&gt;</span> <span class="dv">0</span>),<span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span> <span class="cf">for</span> g1min <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(min_df))]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>g1_dropdown_names <span class="op">=</span> [<span class="bu">str</span>(g1_min_percent[_x]) <span class="op">+</span> <span class="st">' %: '</span> <span class="op">+</span> x <span class="cf">for</span> (_x, x) <span class="kw">in</span> <span class="bu">enumerate</span>(min_df.mineral_name.tolist()) <span class="cf">if</span> g1_min_percent[_x] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> x <span class="op">!=</span> <span class="st">'No_Match'</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>g1_dropdown_names <span class="op">=</span> np.array(g1_dropdown_names)[np.argsort([<span class="bu">float</span>(x.split(<span class="st">' %:'</span>)[<span class="dv">0</span>]) <span class="cf">for</span> x <span class="kw">in</span> g1_dropdown_names])[::<span class="op">-</span><span class="dv">1</span>]].tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b5965751" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive Panel Control For Mineral Band Depth</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>min_select <span class="op">=</span> pn.widgets.Select(name<span class="op">=</span><span class="st">'Mineral Name'</span>, options <span class="op">=</span> g1_dropdown_names, value <span class="op">=</span> g1_dropdown_names[<span class="dv">0</span>])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">@pn.depends</span>(min_select)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_browse(min_select):</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> ds_min[<span class="st">'group_1_band_depth'</span>].where(ds_min[<span class="st">'group_1_mineral_id'</span>] <span class="op">==</span> min_df[<span class="st">'mineral_name'</span>].tolist().index(min_select.split(<span class="st">'%: '</span>)[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">map</span> <span class="op">=</span> mask.hvplot.image(cmap<span class="op">=</span><span class="st">'viridis'</span>, geo<span class="op">=</span><span class="va">True</span>, tiles<span class="op">=</span><span class="st">'ESRI'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,frame_width<span class="op">=</span><span class="dv">450</span>, clim<span class="op">=</span>(<span class="dv">0</span>,np.nanpercentile(mask,<span class="dv">98</span>))).opts(title<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>min_select<span class="sc">}</span><span class="ss"> Band Depth'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">map</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>pn.Row(pn.WidgetBox(min_select),min_browse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-group-2-minerals" class="level2">
<h2 class="anchored" data-anchor-id="visualize-group-2-minerals">2.3 Visualize Group 2 Minerals</h2>
<p>We can do the same thing with Group 2 Minerals. Group 2 will show a more diverse set of minerals in this region, including clays and carbonates.</p>
<div id="6a9862e8-376d-48c8-8af3-6c7a7941326d" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ds_min[<span class="st">'group_2_mineral_id'</span>].hvplot.image(cmap<span class="op">=</span><span class="st">'glasbey'</span>, geo<span class="op">=</span><span class="va">True</span>, tiles<span class="op">=</span><span class="st">'ESRI'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,frame_width<span class="op">=</span><span class="dv">750</span>).opts(title<span class="op">=</span><span class="st">'Group 2 Mineral ID'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b8d3110a-5cd8-474c-99c0-70e9e7ca4021" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>g2_min_percent <span class="op">=</span> [np.<span class="bu">round</span>(np.<span class="bu">sum</span>(ds_min.group_2_mineral_id.data.flatten() <span class="op">==</span> g1min) <span class="op">/</span> np.<span class="bu">sum</span>(ds_min.group_2_mineral_id.data.flatten() <span class="op">&gt;</span> <span class="dv">0</span>),<span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span> <span class="cf">for</span> g1min <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(min_df))]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>g2_dropdown_names <span class="op">=</span> [<span class="bu">str</span>(g2_min_percent[_x]) <span class="op">+</span> <span class="st">' %: '</span> <span class="op">+</span> x <span class="cf">for</span> (_x, x) <span class="kw">in</span> <span class="bu">enumerate</span>(min_df.mineral_name.tolist()) <span class="cf">if</span> g2_min_percent[_x] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> x <span class="op">!=</span> <span class="st">'No_Match'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>g2_dropdown_names <span class="op">=</span> np.array(g2_dropdown_names)[np.argsort([<span class="bu">float</span>(x.split(<span class="st">' %:'</span>)[<span class="dv">0</span>]) <span class="cf">for</span> x <span class="kw">in</span> g2_dropdown_names])[::<span class="op">-</span><span class="dv">1</span>]].tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="284282c0-3be6-4a7b-b054-836d3d83ae69" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive Panel Control For Mineral Band Depth</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>min_select_g2 <span class="op">=</span> pn.widgets.Select(name<span class="op">=</span><span class="st">'Mineral Name'</span>, options <span class="op">=</span> g2_dropdown_names, value <span class="op">=</span> g2_dropdown_names[<span class="dv">0</span>])</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">@pn.depends</span>(min_select_g2)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_browse_g2(min_select):</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(min_select)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> ds_min[<span class="st">'group_2_band_depth'</span>].where(ds_min[<span class="st">'group_2_mineral_id'</span>] <span class="op">==</span> min_df[<span class="st">'mineral_name'</span>].tolist().index(min_select.split(<span class="st">'%: '</span>)[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">map</span> <span class="op">=</span> mask.hvplot.image(cmap<span class="op">=</span><span class="st">'viridis'</span>, geo<span class="op">=</span><span class="va">True</span>, tiles<span class="op">=</span><span class="st">'ESRI'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,frame_width<span class="op">=</span><span class="dv">450</span>, clim<span class="op">=</span>(<span class="dv">0</span>,np.nanpercentile(mask,<span class="dv">98</span>))).opts(title<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>min_select<span class="sc">}</span><span class="ss"> Band Depth'</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">map</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>pn.Row(pn.WidgetBox(min_select_g2),min_browse_g2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-and-filtering-with-uncertainties" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-and-filtering-with-uncertainties">2.4 Visualizing and filtering with uncertainties</h2>
<p>Often just as important as visualizing the core mineral detections is displaying the corresponding uncertainties. The EMIT L2B MIN proudct comes with two different uncertainties (repeated for each group):</p>
<ol type="1">
<li>Fit - this is how good of a fit the individual mineral detection was, as estimated by the correlation coefficient of the alignment between the continuum removed library reference and the continuum removed observed spectra (after scaling).</li>
<li>Band depth uncertainty - this is the propogation of the reflectance uncertainty through the band depth calculation.</li>
</ol>
<p>Letâ€™s take a look at each of these by loading the relevant datasets:</p>
<div id="0a659aac-1e9a-45ae-80e8-42d97f90633b" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open an Orthorectify the Uncertainty Data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ds_min_unc <span class="op">=</span> et.emit_xarray(fp_un)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ds_min_unc <span class="op">=</span> et.ortho_xr(ds_min_unc)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>ds_min_unc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="30c87313-8810-4a29-9358-00e6187d41ce" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>min_select_fit_g2 <span class="op">=</span> pn.widgets.Select(name<span class="op">=</span><span class="st">'Mineral Name'</span>, options <span class="op">=</span> g1_dropdown_names, value <span class="op">=</span> g1_dropdown_names[<span class="dv">0</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="at">@pn.depends</span>(min_select_fit_g2)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_browse_fit_g2(min_select):</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> ds_min_unc[<span class="st">'group_1_fit'</span>].where(ds_min[<span class="st">'group_1_mineral_id'</span>] <span class="op">==</span> min_df[<span class="st">'mineral_name'</span>].tolist().index(min_select.split(<span class="st">'%: '</span>)[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The fits are scaled down by a factor of two in the current EMIT L2B products, so scale them back up:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">map</span> <span class="op">=</span> mask.hvplot.image(cmap<span class="op">=</span><span class="st">'viridis'</span>, geo<span class="op">=</span><span class="va">True</span>, tiles<span class="op">=</span><span class="st">'ESRI'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,frame_width<span class="op">=</span><span class="dv">450</span>, clim<span class="op">=</span>(<span class="dv">0</span>,np.nanpercentile(mask,<span class="dv">98</span>))).opts(title<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>min_select<span class="sc">}</span><span class="ss"> Fit'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">map</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>pn.Row(pn.WidgetBox(min_select_fit_g2),min_browse_fit_g2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregating-and-mineral-abundance" class="level2">
<h2 class="anchored" data-anchor-id="aggregating-and-mineral-abundance">3. Aggregating and Mineral Abundance</h2>
<p>The above visualizations walk through the identification of individual library contituents, and visualize band depths. However, the Tetracorder library used by EMIT contains many substrates that are spectrally distinct, but which may be useful to group together for some science applications. The library also contains many mixtures - both aerial and intimate.</p>
<p>To start, the mineral_grouping_matrix from the emit-sds-l2b repository (coppied locally) contains information aggregated from laboratory XRD analyses to attempt to quantify the abundance of different minerals within each constituent. A -1 in the spreadsheet indicates an unknown but non-zero quantity, which in the few cases in the EMIT-10 columns we assume to be 100%. Letâ€™s open that spreadsheet and take a look:</p>
<div id="9eea13cf" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Mineral Groupings .csv</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>mineral_groupings <span class="op">=</span> pd.read_csv(<span class="st">'../../data/mineral_grouping_matrix_20230503.csv'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The EMIT 10 Minerals are in columns 6 - 17.  Columns after 17 are experimental, and we'll drop for this tutorial:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>mineral_groupings <span class="op">=</span> mineral_groupings.drop([x <span class="cf">for</span> _x, x <span class="kw">in</span> <span class="bu">enumerate</span>(mineral_groupings) <span class="cf">if</span> _x <span class="op">&gt;=</span> <span class="dv">17</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve the EMIT 10 Mineral Names from Columns 7-16 (starting with 0) in .csv</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>mineral_names <span class="op">=</span> [x <span class="cf">for</span> _x, x <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">list</span>(mineral_groupings)) <span class="cf">if</span> _x <span class="op">&gt;</span> <span class="dv">6</span> <span class="kw">and</span> _x <span class="op">&lt;</span> <span class="dv">17</span>]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use EMIT 10 Mineral Names to Subset .csv to only columns with EMIT 10 mineral_names</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>mineral_abundance_ref <span class="op">=</span> np.array(mineral_groupings[mineral_names])</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace Some values in the .csv</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>mineral_abundance_ref[np.isnan(mineral_abundance_ref)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>mineral_abundance_ref[mineral_abundance_ref <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>mineral_groupings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="approximating-mineral-spectral-abundance" class="level1">
<h1>3.1 Approximating Mineral Spectral Abundance</h1>
<p>If we make the assumption that the XRD analysis are accurate, and that band-depth scales linearly with abundance, we can approximate the mineral abundance at the surface. It should be noted that both of these assumptions are fraught - XRD analyses break down for some very small grainsize particles, particularly the Iron Oxides (Goethite and Hematite), and band-depth is heavily influenced by particle grain size, and so the abundance-band depth relationship is not linear. We will expand on these details a bit more later, but for now lets take a look at what happens if we hold both of these as true.</p>
<p>The first step is to run through each mineral that has a non-nan value in the mineral_groupings dataframe, and add up the sum of each of those within the scene. A little matrix multiplication is all we need to do that. Notably, in the emit-sds/emit-sds-l2b, this functionality is already built into the group_aggregator.py script in an efficient mannerâ€¦but because the calculation is simple weâ€™ll reproduce here for learning purposes.</p>
<p>Below, we step through each mineral one at a time, and multiply the band depth by the XRD value for each constintuent in the scene, storing it in a (y,x,band) numpy array, which we can cast into x-array for visualization down the line.</p>
<div id="b830cda5-ddef-40c3-a1ca-a4dcd310c3d6" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mineral_abundance <span class="op">=</span> np.zeros((ds_min[<span class="st">'group_1_band_depth'</span>].shape[<span class="dv">0</span>], ds_min[<span class="st">'group_1_band_depth'</span>].shape[<span class="dv">1</span>], <span class="bu">len</span>(mineral_names)))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _m, mineral_name <span class="kw">in</span> <span class="bu">enumerate</span>(mineral_names):</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Calculating </span><span class="sc">{</span>mineral_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _c <span class="kw">in</span> <span class="bu">range</span>(mineral_groupings.shape[<span class="dv">0</span>]):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.isnan(mineral_groupings[mineral_name][_c]) <span class="op">==</span> <span class="va">False</span>:      </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            group <span class="op">=</span> mineral_groupings[<span class="st">"Group"</span>][_c]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>            mineral_abundance[...,_m] <span class="op">+=</span> (ds_min[<span class="ss">f'group_</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_mineral_id'</span>].values <span class="op">==</span> mineral_groupings[<span class="st">'Index'</span>][_c]) <span class="op">*</span> ds_min[<span class="ss">f'group_</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_band_depth'</span>].values</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>mineral_abundance[np.isnan(mineral_abundance)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>mineral_abundance[np.<span class="bu">all</span>(mineral_abundance <span class="op">==</span> <span class="dv">0</span>, axis<span class="op">=-</span><span class="dv">1</span>),:] <span class="op">=</span> np.nan</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cast as x-array for consistent visualization</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>mineral_abundance_xarray <span class="op">=</span> xr.merge([xr.DataArray(mineral_abundance[...,_x],</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                                                  name<span class="op">=</span>mineral_names[_x],</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                                                  coords<span class="op">=</span>ds_min[<span class="st">'group_1_band_depth'</span>].coords,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                                                  attrs<span class="op">=</span>ds_min.attrs,) </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>                                     <span class="cf">for</span> _x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(mineral_names))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After which we can show them as a widget:</p>
<div id="6ef3cf63-4fa1-4ac9-a43c-cd023769b8ac" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>min_abun_wid <span class="op">=</span> pn.widgets.Select(name<span class="op">=</span><span class="st">'Mineral Abundance'</span>, options <span class="op">=</span> mineral_names, value <span class="op">=</span> mineral_names[<span class="dv">0</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="at">@pn.depends</span>(min_abun_wid)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_abun_browse(mineral_name):</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">map</span> <span class="op">=</span> mineral_abundance_xarray[mineral_name].hvplot.image(cmap<span class="op">=</span><span class="st">'viridis'</span>, geo<span class="op">=</span><span class="va">True</span>, tiles<span class="op">=</span><span class="st">'ESRI'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,frame_width<span class="op">=</span><span class="dv">450</span>, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                                              clim<span class="op">=</span>(<span class="dv">0</span>,np.nanpercentile(mineral_abundance_xarray[mineral_name],<span class="dv">98</span>))).opts(<span class="op">\</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                                                              title<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>mineral_name<span class="sc">}</span><span class="ss"> Spectral Abundance'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">map</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>pn.Row(pn.WidgetBox(min_abun_wid),min_abun_browse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also take a look at the histogram distributions</p>
<div id="27283418-47fb-423e-b848-fda2754d0506" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>max_bin_max <span class="op">=</span> np.<span class="bu">max</span>([np.nanpercentile(mineral_abundance_xarray[x].values,<span class="dv">98</span>) <span class="cf">for</span> x <span class="kw">in</span> mineral_names])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mineral_abundance_xarray.hvplot.hist(y<span class="op">=</span>mineral_names, cmap<span class="op">=</span><span class="st">'glasbey'</span>, bins<span class="op">=</span><span class="dv">50</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="st">'left'</span>, bin_range<span class="op">=</span>(<span class="fl">0.001</span>, max_bin_max), </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                     xlabel<span class="op">=</span><span class="st">'Spectral Abundance'</span>, ylabel<span class="op">=</span><span class="st">'Pixel Count'</span>, title<span class="op">=</span><span class="st">''</span>,frame_width<span class="op">=</span><span class="dv">650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notably, these abundance fractions do not sum to one. This can either be due to copmlex mixtures that arenâ€™t fully captured, or due to the presence of additional materials that do not directly absorb in the VSWIR - most namely quartz and feldspar, but also including organic soil matter, as well as NPV and PV. To illustrate this, letâ€™s examine the totals.</p>
<div id="fc40f552-8830-4e50-b55c-83b994fb5a4c" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>total_mineral_abundance <span class="op">=</span> xr.DataArray(np.nansum(mineral_abundance,axis<span class="op">=-</span><span class="dv">1</span>), </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                                       name<span class="op">=</span><span class="st">'Total Abundance'</span>, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                                       coords<span class="op">=</span>ds_min[<span class="st">'group_1_band_depth'</span>].coords, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                                       attrs<span class="op">=</span>ds_min.attrs,)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>total_mineral_abundance.hvplot.hist(y<span class="op">=</span>[<span class="st">'Total Abundance'</span>], cmap<span class="op">=</span><span class="st">'glasbey'</span>, bins<span class="op">=</span><span class="dv">50</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="st">'left'</span>, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                                    bin_range<span class="op">=</span>(<span class="fl">0.001</span>, np.nanpercentile(total_mineral_abundance.values, <span class="fl">99.9</span>)), </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                                    xlabel<span class="op">=</span><span class="st">'Spectral Abundance'</span>, ylabel<span class="op">=</span><span class="st">'Pixel Count'</span>, title<span class="op">=</span><span class="st">''</span>,frame_width<span class="op">=</span><span class="dv">650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exporting-to-cloud-optimized-geotiffs" class="level2">
<h2 class="anchored" data-anchor-id="exporting-to-cloud-optimized-geotiffs">4. Exporting To Cloud-Optimized Geotiffs</h2>
<p>We can select layers from any of the xarray datasets weâ€™ve created and export them to a Cloud-Optimized Geotiff (COG) using the <code>rio.to_raster</code> function from the <code>rasterio</code> library. This will allow us to share the data with others or use it in other GIS software.</p>
<p>First create an output folder.</p>
<div id="677f044d" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Out filenames and set folder</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>out_folder <span class="op">=</span> <span class="st">'../../data/output/'</span> <span class="co"># may need to change based on your directory structure</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create out_folder if it does not exist</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(out_folder):</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>   os.makedirs(out_folder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mineral-id" class="level3">
<h3 class="anchored" data-anchor-id="mineral-id">4.1 Mineral ID</h3>
<div id="9a83fd5b" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set output Filename</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>out_name <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>ds_min<span class="sc">.</span>granule_id<span class="sc">}</span><span class="ss">_group_1_mineral_id.tif'</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select Group to Output</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>dat_out <span class="op">=</span> ds_min[<span class="st">'group_1_mineral_id'</span>]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace nan with a fill value</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>dat_out.data <span class="op">=</span> np.nan_to_num(dat_out.data, nan<span class="op">=-</span><span class="dv">9999</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Change datatype for integers/categorical</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>dat_out.data <span class="op">=</span> dat_out.data.astype(<span class="bu">int</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode nodata value</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>dat_out.rio.write_nodata(<span class="op">-</span><span class="dv">9999</span>, encoded<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Write data to COG</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>dat_out.rio.to_raster(raster_path<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>out_folder<span class="sc">}{</span>out_name<span class="sc">}</span><span class="ss">'</span>, driver<span class="op">=</span><span class="st">'COG'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="band-depth" class="level3">
<h3 class="anchored" data-anchor-id="band-depth">4.2 Band Depth</h3>
<div id="7f32807f" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set output Filename</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>out_name <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>ds_min<span class="sc">.</span>granule_id<span class="sc">}</span><span class="ss">_group_1_band_depth.tif'</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select Group to Output</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>dat_out <span class="op">=</span> ds_min[<span class="st">'group_1_band_depth'</span>]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace nan with a fill value</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>dat_out.data <span class="op">=</span> np.nan_to_num(dat_out.data, nan<span class="op">=-</span><span class="dv">9999</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode nodata value</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>dat_out.rio.write_nodata(<span class="op">-</span><span class="dv">9999</span>, encoded<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Write data to COG</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>dat_out.rio.to_raster(raster_path<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>out_folder<span class="sc">}{</span>out_name<span class="sc">}</span><span class="ss">'</span>, driver<span class="op">=</span><span class="st">'COG'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="abundance" class="level3">
<h3 class="anchored" data-anchor-id="abundance">4.3 Abundance</h3>
<div id="f62e0222" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set output Filename</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>out_name <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>mineral_abundance_xarray<span class="sc">.</span>granule_id<span class="sc">}</span><span class="ss">_Calcite.tif'</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select Layer</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>dat_out <span class="op">=</span> mineral_abundance_xarray[<span class="st">'Calcite'</span>]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace nan with a fill value</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>dat_out.data <span class="op">=</span> np.nan_to_num(dat_out.data, nan<span class="op">=-</span><span class="dv">9999</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode nodata value</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>dat_out.rio.write_nodata(<span class="op">-</span><span class="dv">9999</span>, encoded<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Write data to COG</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>dat_out.rio.to_raster(raster_path<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>out_folder<span class="sc">}{</span>out_name<span class="sc">}</span><span class="ss">'</span>, driver<span class="op">=</span><span class="st">'COG'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="contact-info" class="level2">
<h2 class="anchored" data-anchor-id="contact-info">Contact Info:</h2>
<p>Email: LPDAAC@usgs.gov<br>
Voice: +1-866-573-3222<br>
Organization: Land Processes Distributed Active Archive Center (LP DAAC)Â¹<br>
Website: <a href="https://lpdaac.usgs.gov/" class="uri">https://lpdaac.usgs.gov/</a><br>
Date last modified: 07-07-2024</p>
<p>Â¹Work performed under USGS contract 140G0121D0001 for NASA contract NNG14HH33I.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nasa\.github\.io\/LPDAAC-Data-Resources\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../external/Finding_EMIT_L2B_Data.html" class="pagination-link" aria-label="9. Finding EMIT L2B Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">9. Finding EMIT L2B Data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../CONTRIBUTING.html" class="pagination-link" aria-label="Contributing to this Repository">
        <span class="nav-page-text">Contributing to this Repository</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>NASA Land Processes Distributed Active Archive Center (LP DAAC) | United States Geological Survey (USGS) Earth Resources Observation and Science (EROS) Center</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>